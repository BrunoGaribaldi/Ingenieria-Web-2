<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/Styles/header.css" />
    <link href="/Styles/asdasdasd.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Administrar Productos</h3>
        <!--  <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-outline-primary active"
            href="/admin/pedidos"
            id="btn-todos"
          >
            Todos
          </button>
          <button
            type="button"
            class="btn btn-outline-success"
            id="btn-activos"
          >
            Activos
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary"
            id="btn-no-activos"
          >
            No Activos
          </button>
        </div> -->
        <!-- <div class="row mb-3">
          <div class="col-md-3">
            <select id="tipo-busqueda" class="form-select">
              <option value="nombre">Buscar por nombre</option>
              <option value="id">Buscar por ID</option>
            </select>
          </div>
          <div class="col-md-9">
            <input
              type="text"
              id="buscador-clientes"
              class="form-control"
              placeholder="Buscar cliente..."
            />
          </div>
        </div> -->
      </div>
      <div style="margin-bottom: 20px">
        <a href="/admin/create-product">
          <button class="btn btn-success" id="btn-agregar-producto">
            <i class="bi bi-plus-circle"></i> Agregar Producto
          </button>
        </a>
      </div>

      <table
        class="table table-bordered table-hover align-middle"
        id="tabla-productos"
      >
        <thead class="table-light">
          <tr>
            <th>Categoría</th>
            <th>Modelo</th>
            <th>Marca</th>
            <th>Genero</th>
            <th>Precio</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpo-tabla"></tbody>
      </table>
    </div>
    <script src="/js/header.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const res = await axios.get("/products/api/list");
          const productos = res.data.productos;
          const tbody = document.getElementById("cuerpo-tabla");
          // Renderiza los productos en el DOM
          console.log(productos);

          productos.forEach((producto) => {
            const tr = document.createElement("tr");

            // Categoría
            const tdCategoria = document.createElement("td");
            tdCategoria.textContent = producto.categoria;
            tr.appendChild(tdCategoria);

            // Modelo
            const tdModelo = document.createElement("td");
            tdModelo.textContent = producto.modelo;
            tr.appendChild(tdModelo);

            // Marca
            const tdMarca = document.createElement("td");
            tdMarca.textContent = producto.marca;
            tr.appendChild(tdMarca);

            // Genero
            const tdGenero = document.createElement("td");
            tdGenero.textContent = producto.genero;
            tr.appendChild(tdGenero);

            // Precio
            const tdPrecio = document.createElement("td");
            tdPrecio.textContent = `$${producto.precio}`;
            tr.appendChild(tdPrecio);

            // Acciones
            const tdAcciones = document.createElement("td");
            tdAcciones.className = "text-center";
            tdAcciones.innerHTML = `
          <a href="/products/list/${producto.id}"><button class="btn btn-sm btn-success">Ver detalle</button></a>
           <a href="/admin/edit-product/${producto.id}"><button class="btn btn-sm btn-warning">Editar</button></a>
          <button data-id="${producto.id}" class="eliminar-button btn btn-sm btn-danger">Eliminar</button>
        `;
            tr.appendChild(tdAcciones);

            tbody.appendChild(tr);
          });
        } catch (err) {}

        // Después del forEach, agregamos los listeners:
        document.querySelectorAll(".eliminar-button").forEach((btn) => {
          btn.addEventListener("click", async function () {
            const id = this.getAttribute("data-id");
            try {
              await axios.post(`/admin/delete-product/${id}`);
              //recargar la tabla o eliminar la fila del DOM
              this.closest("tr").remove();
            } catch (err) {
              alert("Error al eliminar el producto");
            }
          });
        });
      });
    </script>
  </body>
</html>
